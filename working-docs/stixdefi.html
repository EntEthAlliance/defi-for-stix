<!DOCTYPE html>
<html lang="en">
<head>
<meta charset='utf-8'>
<title>EEA DeFi extensions for STIX - Editor's Working Draft</title>

<!-- New EEA js template file -->
<script src='./javascript/respec-eea-common.js' async class='remove'></script>

<style>
table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
}
th, td {
    padding: 5px;
}
*[id^=risk-]:not(.removed), .reqEx { border: 1px purple solid; background-color: #ffeeee80; padding: 0.5em }
*[id^=mit-]:not(.removed), .mitEx { border: 1px blue solid; background-color: #ddddff80; padding: 0.5em }
*[id^=rep-]:not(.removed), .repEx { border: 1px purple solid; background-color: #bbddff80; padding: 0.5em }
#sotd, #abstract {display:none}
</style>

</head>

<body>

    <section id="sotd">
      <h5>remove This</h5>
    </section>
    <section id="abstract">
      <h5>remove This</h5>
    </section>

  <section id="sec-introduction" class="informative">

  <h2>Introduction</h2>


<section id="sec-purpose-of-this-document">
  <h3>Executive Summary</h3>

  This will hopefully be an extension of STIX, providing properties that are helpful in using STIX for blockchain-
  and particularly DeFi-oriented usage of STIX.

<section id="sec-purpose">
<h4>Purpose</h4>


</section>

</section>



<section id="sec-copyright">
  <h3>Copyright License Terms</h3>

  This document is licensed under the terms of the
  [Apache License, Version 2.0](http://www.apache.org/licenses/LICENSE-2.0) [[License]]
  Unless otherwise explicitly authorized in writing by the EEA,
  you can only use this document in accordance with those terms.

  This document is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
  neither express nor implied.

  See the [[License]] for the specific language governing permissions and limitations automatically granted by EEA.
</section>



    <!--section id="sec-definitions" title="The list of terms is autogenerated from the definitions used">

    <h3>Defined Terms</h3>

  <p>
The following is a list of terms defined in this Specification.
  </p>

  <div class="inside">
    <ul class="respec-dfn-list">
    The list of terms is autogenerated from the definitions in the doc.
    </ul>
  </div>

</section-->

    <section id="sec-summary-of-requirements">

    <h3>Summary of Requirements</h3>

This section provides a summary of all requirements in this Specification.



    <section id="sec-acknowledgments">

    <h3>Acknowledgments</h3>

The EEA acknowledges and thanks the many people who contributed to the
development of this version of the specification, and the organisations that supported them
to make their contributions. Please advise us of any errors or omissions.

This work has also drawn on the work of DeFiSafety on processes to review <a>DeFi Protocols</a>.

This work was made possible thanks to generous initial support from Consensys Software.

<!--Individuals who contribute to a given version SHOULD be acknowledged in the `dummycontrib` parameter in the sourcecode-->

    </section>

    <!--section id="sec-changes">

    <h3>Changes</h3>

    THIS MIGHT BE USEFUL IF WE HAVE A SECOND VERSION

Full details of all changes since the version 1.0 release of this Specification
are available in the
[GitHub repository for this Specification](https://github.com/entethalliance/DRAMA).

This section outlines substantive changes made to the specification since
version 1:

<section>
<h4>New Risks Described</h4>

- [**Obfuscated, or misrepresented change proposal**](#risk-gov-obfuscated)

</section>
<section>
<h4>New Mitigations Described</h4>

- [**Log core events on-chain**](#mit-log-events)
- [**Split and Isolate Liquidity Pools**](#mit-split-honeypots)


Old requirements have been removed from earlier versions of the specification,
for a variety of reasons.
The full list of requirements removed in earlier versions is:
<b id="req-acct-010">ACCT-010</b>,
<b id="req-acct-020">ACCT-020</b>,
<b id="req-cons-010">CONS-010</b>,
<b id="req-xcli-005">XCLI-005</b>, and
<b id="req-xcli-010">XCLI-010</b>.

-->
</section>


<script class='remove'>

//some of this we probably won't want...
async function loadSolidity() {    //this is the function you call in 'preProcess'
    const worker = await new Promise(resolve => {
      require(["core/worker"], ({ worker }) => resolve(worker));
    });
    const action = "highlight-load-lang";
    const langURL =
      "https://rawgit.com/pospi/highlightjs-solidity/master/solidity.js";
    const propName = "hljsDefineSolidity";
    const lang = "solidity";     // this is the class you use to identify the language
    worker.postMessage({ action, langURL, propName, lang });
    return new Promise(resolve => {
      worker.addEventListener("message", function listener({ data }) {
        const { action: responseAction, lang: responseLang } = data;
        if (responseAction === action && responseLang === lang) {
          worker.removeEventListener("message", listener);
          resolve();
        }
      });
    });
  }


// Wrapper function for the Summaries and Defined Terms,
// (and commented out, the Events, Functions, and Parameters functions).
function postProcess(){
  Summary("risk","sec-summary-of-risks");
  Summary("rep","sec-summary-of-reports");
  Summary("mit","sec-summary-of-mitigations");
//  reportSummary();
	defTerms();
  //Fix stuff...
  document.querySelector("[href^='https://www.w3.org/StyleSheets/TR/2016/W3C-EEA']").href = "https://www.w3.org/StyleSheets/TR/2016/base.css";
  document.querySelector("[rel='canonical']").remove();
//  document.querySelector("#removeme").remove();
}

// Clones all risks in the doc into the Summary of Risks section.
function Summary (prefix, placeholderID) {
  // Get all the risks in the specification.
  var allItems = document.querySelectorAll("[id^='"+prefix+"']");
  // Loop through each risk.
  for (i = 0; i < allItems.length; i++) {
    // Clone the risk.
    var item = allItems[i].cloneNode(true);

    // In each risk, replace any dfn tags with anchor tags.
    // Get all dfn elements in the risk.
    var allDfns = item.getElementsByTagName("dfn");
    // Loop through each dfn
    for (j = 0; j < allDfns.length; j++) {
      // Create an empty anchor element
      var anchor = document.createElement("a");
      // Use the dfn text as the href text, convert it to lower case,
      // and replace spaces with hyphens.
      var hreftext=allDfns[j].innerText.toLowerCase();
      hreftext=hreftext.replace(/ /g,"-");
      // Set the href attribute on the anchor element
      anchor.setAttribute("href", "#dfn-" + hreftext);
      // Set the HTML for the anchor element as the HTML of the dfn element.
      anchor.innerHTML = allDfns[j].innerHTML;
      // Insert the anchor element before the dfn element.
      item.insertBefore(anchor, allDfns[j]);
      // Remove the dfn element.
      item.removeChild(allDfns[j]);
    }

    // Get the HTML text, id, class, and tag name from the risk.
    var itemhtml = item.innerHTML;
    var itemid = item.id;
    var itemclass = item.className;
    var itemtagname = item.tagName;

    // itemid and itemclass determines the risk type. If:
    // - id=prefix-* & !class          A regular risk in a paragraph, or
    //                              sometimes with an ordinary list
    // - id=prefixg-* & !class         A header for  a risk list
    //
    // - id=prefix-* & class=prefixitem   A risk in a list. The list
    //                              follows a header.

    // Test for the risk type and process accordingly.
    if (itemid.slice(0,(prefix.length+1)) == (prefix + "-") && !itemclass) {
      // Update the HTML text, wrapping the risk number in anchor tags to
      // link back to original risk.
      var tmp = itemhtml.replace("<b>","<a href=\"#" + itemid + "\"><b>");
      var newitemhtml = tmp.replace("</b>","</b></a>");
      // Create an empty p or div node to contain the item.
      // p if it's a regular item in a para, or div if the item
      // also has an ordinary list with it.
      if (itemtagname == "P") {
        var nodetype = "p";
      } else if (itemtagname == "B") { var nodetype = 0; }
      else {
      	var nodetype = "div";
      }
      if (nodetype) {
        var node = document.createElement(nodetype);
      // Assign a unique id to the node.
      node.id = "summ-" + itemid;
      // Append the empty node to Summary of Risks section.
      document.getElementById(placeholderID).appendChild(node);
      // Assign the updated HTML text to the node.
      document.getElementById(node.id).innerHTML = newitemhtml;}
      }
    if (itemid.slice(0,((prefix.length+1))) == (prefix + "g") && !itemclass) {
      // Create an empty p node to contain the ordinary sentence.
      var node = document.createElement("p");
      // Assign a unique id to the node.
      node.id = "summ-" + riskid;
      // Append the empty node to Summary section.
      document.getElementById(placeholderID).appendChild(node);
      // Assign the unchanged HTML text to the paragraph node.
      document.getElementById(node.id).innerHTML = itemhtml;
      // Create an empty ul node to contain the item list.
      list = document.createElement("ul");
      // Assign a unique id to the node.
      list.id = "list-" + itemid;
      // Append the empty node to the Summary section.
      document.getElementById(placeholderID).appendChild(list);
      }
    if (itemid.slice(0,((prefix.length+1))) == (prefix + "-") && itemclass == (prefix + "item")) {
      // Update the HTML text, wrapping the item number in anchor tags to
      // link back to original item.
      var tmp = itemhtml.replace("<b>","<a href=\"#" + itemid + "\"><b>");
      var newitemhtml = tmp.replace("</b>","</b></a>");
      // Create an empty li node to contain the item.
      var node = document.createElement("li");
      // Assign a unique id to the node.
      node.id = "summ-" + itemid;
      // Append the empty node to the previously created ul node.
      document.getElementById(list.id).appendChild(node);
      // Assign the updated HTML text to the node.
      document.getElementById(node.id).innerHTML = newitemhtml;
    }

  }
}

// Clones all reporting in the doc into the Summary of Reporting section.
//
// This is just copy-pasta from above and wants to be refactored.
//
function reportSummary () {
  // Get all the reports in the specification.
  var allReports = document.querySelectorAll("[id^='rep']");
  // Loop through each report.
  for (i = 0; i < allReports.length; i++) {
    // Clone the report.
    var report = allReports[i].cloneNode(true);

    // In each report, replace any dfn tags with anchor tags.
    // Get all dfn elements in the report.
    var allDfns = report.getElementsByTagName("dfn");
    // Loop through each dfn
    for (j = 0; j < allDfns.length; j++) {
      // Create an empty anchor element
      var anchor = document.createElement("a");
      // Use the dfn text as the href text, convert it to lower case,
      // and replace spaces with hyphens.
      var hreftext=allDfns[j].innerText.toLowerCase();
      hreftext=hreftext.replace(/ /g,"-");
      // Set the href attribute on the anchor element
      anchor.setAttribute("href", "#dfn-" + hreftext);
      // Set the HTML for the anchor element as the HTML of the dfn element.
      anchor.innerHTML = allDfns[j].innerHTML;
      // Insert the anchor element before the dfn element.
      report.insertBefore(anchor, allDfns[j]);
      // Remove the dfn element.
      report.removeChild(allDfns[j]);
    }

    // Get the HTML text, id, class, and tag name from the reportuirement.
    var reporthtml = report.innerHTML;
    var reportid = report.id;
    var reportclass = report.className;
    var reporttagname = report.tagName;

    // reportid and reportclass determines the report type. If:
    // - id=rep-* & !class          A regular report in a paragraph, or
    //                              sometimes with an ordinary list
    // - id=repg-* & !class         A header for a report list
    //
    // - id=rep-* & class=reportitem   A report item in a list. The list
    //                              follows a header.

    // Test for the report type and process accordingly.
    if (reportid.slice(0,4) == "rep-" && !reportclass) {
      // Update the HTML text, wrapping the report number in anchor tags to
      // link back to original report.
      var tmp = reporthtml.replace("<b>","<a href=\"#" + reportid + "\"><b>");
      var newreporthtml = tmp.replace("</b>","</b></a>");
      // Create an empty p or div node to contain the report.
      // p if it's a regular report in a para, or div if the report
      // also has an ordinary list with it.
      if (reporttagname == "P") {
        var nodetype = "p";
      } else if (reporttagname == "B") { var nodetype = 0; }
      else {
      	var nodetype = "div";
      }
      if (nodetype) {
        var node = document.createElement(nodetype);
      // Assign a unique id to the node.
      node.id = "summ-" + reportid;
      // Append the empty node to Summary of Reports section.
      document.getElementById("sec-summary-of-reporting").appendChild(node);
      // Assign the updated HTML text to the node.
      document.getElementById(node.id).innerHTML = newreporthtml;}
      }
    if (reportid.slice(0,4) == "repg" && !reportclass) {
      // Create an empty p node to contain the ordinary sentence.
      var node = document.createElement("p");
      // Assign a unique id to the node.
      node.id = "summ-" + reportid;
      // Append the empty node to Summary of Requirements section.
      document.getElementById("sec-summary-of-reporting").appendChild(node);
      // Assign the unchanged HTML text to the paragraph node.
      document.getElementById(node.id).innerHTML = reporthtml;
      // Create an empty ul node to contain the requirements list.
      list = document.createElement("ul");
      // Assign a unique id to the node.
      list.id = "list-" + reportid;
      // Append the empty node to Summary of Information section.
      document.getElementById("sec-summary-of-reporting").appendChild(list);
      }
    if (reportid.slice(0,4) == "rep-" && reportclass == "repitem") {
      // Update the HTML text, wrapping the requirement number in anchor tags to
      // link back to original requirement.
      var tmp = reporthtml.replace("<b>","<a href=\"#" + reportid + "\"><b>");
      var newreporthtml = tmp.replace("</b>","</b></a>");
      // Create an empty li node to contain the requirement.
      var node = document.createElement("li");
      // Assign a unique id to the node.
      node.id = "summ-" + reportid;
      // Append the empty node to the previously created ul node.
      document.getElementById(list.id).appendChild(node);
      // Assign the updated HTML text to the node.
      document.getElementById(node.id).innerHTML = newreporthtml;
    }

  }
}

// Retrieves all defined terms in the doc, sorts them, and lists them in the
// Defined Terms section.
function defTerms () {
  // Get all the definitions in the specification.
  var allDfns = document.getElementsByTagName("dfn");
  // Can't sort an HTMLCollection, so put it into array first, then sort it.
  allDfns = Array.prototype.slice.call(allDfns);
  allDfns.sort(function(a, b){
      return a.textContent.localeCompare(b.textContent);
  });

  // Loop through each definition.
  for (i = 0; i < allDfns.length; i++) {
    // Clone the definition.
    var dfn = allDfns[i].cloneNode(true);
    // Get the HTML text from the definition.
    var dfnhtml = dfn.innerHTML;
    // If it's a code definition (functions, events, etc.) skip it.
    if (dfnhtml.slice(0,6) == "<code>") {
      continue;
    }
    // Test for strings to keep as upper case, otherwise convert to lower case.
//    var stringexists = false;
//    var setofstrings = ['Ethereum', 'DEV', 'Apps'];
//    for (var j =0; j < setofstrings.length; j++) {
//      if (dfnhtml.indexOf(setofstrings[j]) != -1) {
//        stringexists = true;
//      }
//    }
//    if (!stringexists) {
//      dfnhtml = dfnhtml.toLowerCase();
//    }
    // Get the data-lt attribute, if it exists, to use as the href value.
    var datalt = dfn.getAttribute("data-lt");
    // If a data-lt attribute exists, get it, otherwise use the HTML text.
    if (datalt) {
      // Get the position of the first pipe character.
      var pipepos = datalt.indexOf("|");
      // If no pipe char, use the whole text, otherwise up to the first pipe.
      if (pipepos == -1) {
        var x = datalt;
      } else {
        var x = datalt.slice(0,pipepos);
      }
    } else {
      var x = dfnhtml;
    }
    // Convert the href text to lower case and replace spaces with hyphens.
    var dfnhref = x.toLowerCase().replace(/ /g,"-").replace(/\//g,"-");

    // Create an empty li node
    var item = document.createElement("li");
    // Assign a unique id to the li node.
    item.id = "item-" + i;
    // Append the empty node to the respec-dfn-list ul node.
    var dfnlist = document.getElementsByClassName("respec-dfn-list");
    dfnlist[0].appendChild(item);

    // Create an empty anchor node to contain the link.
    var anchor = document.createElement("a");
    // Assign a unique id to the anchor node.
    anchor.id = "dfnanchor-" + i;
    anchor.setAttribute("href", "#dfn-" + dfnhref);
    // Append the empty a node to the li node.
    document.getElementById(item.id).appendChild(anchor);
    // Assign the updated HTML text to the paragraph node.
    document.getElementById(anchor.id).innerHTML = dfnhtml;
  }
}



var respecConfig = {
  preProcess: [loadSolidity],
  format: "markdown",
// New EEA specStatus
  specStatus: "EEA",
// New EEA license, if we ever want to include the details
  license: "eea",
// New pluralize option, so you don't have to define the plural version of a link anymore
  pluralize: true,
  edDraftURI: "https://entethalliance.github.io/DRAMA/defi-risks.html",
  //github: "https://github.com/EntEthAlliance/@@updateme",
  shortName: "defi-risk",
  copyrightStart: 2022,
// All the postProcess cleanup now handled by the main js template
  postProcess: [postProcess],
  editors: [{
    name: "chaals nevile",
    company: "EEA",
    mailto: "chaals@entethalliance.org"
  }],
  logos: [{
    src: './images/eea_logo.svg',
    url: "https://entethalliance.org",
    alt: "EEA",
    width: 180,
    height: 90,
    id: 'eea-logo'
  }],
  otherLinks: [{
    key: "Latest Release version",
    data: [{
      value: "https://entethalliance.org/specs/defi-risks/v1/",
      href: "https://entethalliance.org/specs/defi-risks/v1/"
    }]
  },
    {
      key: "Latest release URL",
      data: [{
        value: "https://entethalliance.org/specs/defi-risks/",
        href: "https://entethalliance.org/specs/defi-risks/"
      }]
      },
      {
    key: "Contributors to this document",
    data: [{
      value: "Dmytro Budorin - Дмитро Будорін (Hacken), \
      Elizabeth Campbell (Consensys), \
      Valerian Callens (Quantstamp), \
      Juan Costa (Noves),  \
      Vinicius Farias Ribeiro (Cube3.AI), \
      Andrew Forman (EY), \
      Bernhard Gotthart (EY), \
      Einaras Gravrock (Cube3.AI), \
      Lisa Gutierrez (C4), \
      James Harsh (EEA), \
      Tremaine Hudson (Cryptio), \
      Bill Hughes (Consensys), \
      Rex Hygate (DeFi Safety), \
      Herman Junge (Consensys), \
      Stylianos Kampakis (Hacken), \
      Paul Kang (Entersoft), \
      Damian Kuthoore (EY), \
      Jessica Levesque (C4), \
      Andrew Lunde (SAP), \
      Kunz Mainali (Bitwave), \
      Dominik Muhs, \
      Boris Nelkin (DTCC), \
      Jerome Ostorero (Coinchange), \
      Carlo Parisi (Hacken), \
      Tim Pechersky (OpenZeppelin), \
      Gerard Persoon, \
      Jeff Rundlet (Cryptio), \
      Sissi Ruthe (SAP), \
      Kostiantyn Shost (Hacken), \
      Przemek Siemion (Banco Santander), \
      Monica Singer (Consensys), \
      Linas Stankevičius (Hacken), \
      David Tarditi (CertiK), \
      Jim Thompson (Bitwave), \
      Carlos Vivas (DTCC), \
      Pratik Wagh (Coinchange), \
      Clemens Wan (Consensys), \
      Trevor Ward (Bitwave), \
      Morgan Weaver (OpenZeppelin), \
      John Whelan (Banco Santander), \
      Mark Young (Consensys), \
      Sophia Zaller (Relm), \
      Joseph Ziolkowski (Relm)",
    href: "dummycontrib"
    }]
  }],
  localBiblio: {
    "CCSS": {
      title: "CryptoCurrency Security Standard",
      href: "https://cryptoconsortium.org/cryptocurrency-security-standard-documentation/details/",
      publisher: "C4"
    },
    "CVE": {
      title: "CyberSecurity Vulnerabilities",
      href: "https://www.cve.org",
      publisher: "MITRE"
    },
    "CWE": {
      title: "Common Weakness Enumeration",
      href: "https://cwe.mitre.org/",
      publisher: "MITRE"
    },
    "EthTrust": {
      title: "EEA EthTrust Security Levels Specification v1",
      href: "https://entethalliance.org/specs/ethtrust-sl/v1",
      publisher: "Enterprise Ethereum Alliance"
    },
    "defy-DeFi": {
      title: "Sure You can DeFi but you Can't Defy Risk",
      href: "https://www.fticonsulting.com/insights/fti-journal/sure-you-can-defi-but-you-cant-defy-risk",
      publisher: "FTI Consulting"
    },
    "fasb-expodraft": {
      title: "Proposed Accounting Standards Update — Intangibles — Goodwill and Other — Crypto Assets (Subtopic 350-60): Accounting for and Disclosure of Crypto Assets",
      href: "https://www.fasb.org/Page/ShowPdf?path=Prop+ASU%E2%80%94Intangibles%E2%80%94Goodwill+and+Other%E2%80%94Crypto+Assets+%28Subtopic+350-60%29%E2%80%94Accounting+for+and+Disclosure+of+Crypto+Assets.pdf&title=Proposed+Accounting+Standards+Update%E2%80%94Intangibles%E2%80%94Goodwill+and+Other%E2%80%94Crypto+Assets+%28Subtopic+350-60%29%3A+Accounting+for+and+Disclosure+of+Crypto+Assets&acceptedDisclaimer=true&IsIOS=false&Submit=",
      publisher: "Financial Standards Accounting Board"
    },
    "ISO27001": {
      title: "ISO/IEC 27001 - Information security management systems",
      href: "https://www.iso.org/standard/27001",
      publisher: "ISO"
    },
    "License": {
      title: "Apache license version 2.0",
      href: "http://www.apache.org/licenses/LICENSE-2.0",
      publisher: "The Apache Software Foundation"
    },
    "millionis": {
      title: "Automated Market Making and Loss-Versus-Rebalancing",
      href: "https://anthonyleezhang.github.io/pdfs/lvr.pdf",
      date: "13 August 2022",
      authors: ["Jason Millionis", "Ciamac C. Mollaemi", "Tim Roughgarden", "Anthony Lee Zhang"]
    },
    "ofac": {
      title: "Office of Foreign Assets Control",
      href: "https://ofac.treasury.gov/",
      publisher: "U.S. Department of Treasury"
    },
    "owasp-apis": {
      title: "OWASP API Security Project",
      href: "https://owasp.org/www-project-api-security/",
      publisher: "The Open Worldwide Application Security Project"
    },
    "owasp-asvs": {
      title: "OWASP Application Security Verification Standard",
      href: "https://owasp.org/www-project-application-security-verification-standard/",
      publisher: "The Open Worldwide Application Security Project"
    },
    "owasp-masvs": {
      title: "OWASP Mobile Application Security Verification Standard",
      href: "https://mas.owasp.org/MASVS/",
      publisher: "The Open Worldwide Application Security Project"
    },
    "respec": {
      title: "ReSpec Documentation",
      href: "https://respec.org/docs"
    },
    "STIX": {
      title: "Standardizing Cyber Threat Intelligence Information with the Structured Threat Information Expression (STIX)",
      href: "https://www.mitre.org/sites/default/files/publications/stix.pdf",
      publisher: "MITRE"
    },
    "SOC1": {
      title: "SOC 1® - SOC for Service Organizations: ICFRa",
      href: "https://www.aicpa-cima.com/topic/audit-assurance/audit-and-assurance-greater-than-soc-1",
      publisher: "The American Institute of CPAs"
    },
    "SOC2": {
      title: "SOC 2® - SOC for Service Organizations: Trust Services Criteria",
      href: "https://www.aicpa-cima.com/topic/audit-assurance/audit-and-assurance-greater-than-soc-2",
      publisher: "The American Institute of CPAs"
    },
    "xchain-sec": {
      title: "EEA Crosschain Security Guidelines 1.0",
      href: "https://entethalliance.github.io/crosschain-interoperability/crosschainsecurityguidelines.html",
      publisher: "Enterprise Ethereum Alliance"
    }
  }
};
</script>

</body>

</html>
